---
import TimelineItem from "./TimelineItem.astro";
import BriefcaseIcon from "@/components/icons/Briefcase.astro";

import { EXPERIENCE } from "@/data";
import { DISPLAY_LIMITS } from "@/config/site";

const LIMIT = DISPLAY_LIMITS.experience;
---

<h2 class='text-2xl font-semibold flex gap-x-3 mb-2 items-center text-gray-900 dark:text-white'>
    <BriefcaseIcon class='size-4 md:size-6' />
    Experiencia Laboral
</h2>

<ol class='relative border-s border-gray-400 dark:border-gray-700 ml-3' id='timeline-list'>
    {
        EXPERIENCE.map((it, i) => (
            <TimelineItem
                id={it.id}
                period={it.period}
                title={it.title}
                subtitle={it.subtitle}
                descriptionShort={it.descriptionShort}
                description={it.description}
                isLastest={i === 0}
                badgs={it.badgs}
                isHidden={i >= LIMIT}
            >
                {it.link && (
                    <a
                        href={it.link}
                        target='_blank'
                        class='inline-flex items-center px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:outline-none focus:ring-gray-200 focus:text-blue-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700'
                    >
                        Ver más
                        <svg
                            class='w-3 h-3 ms-2 rtl:rotate-180'
                            aria-hidden='true'
                            xmlns='http://www.w3.org/2000/svg'
                            fill='none'
                            viewBox='0 0 14 10'
                        >
                            <path
                                stroke='currentColor'
                                stroke-linecap='round'
                                stroke-linejoin='round'
                                stroke-width='2'
                                d='M1 5h12m0 0L9 1m4 4L9 9'
                            />
                        </svg>
                    </a>
                )}
            </TimelineItem>
        ))
    }
</ol>

{
    EXPERIENCE.length > LIMIT && (
        <button
            id='show-more-experience'
            class='mt-6 w-full px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:outline-none focus:ring-gray-200 focus:text-blue-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700'
        >
            Ver más experiencias
        </button>
    )
}

<script>
    const showMoreBtn = document.getElementById("show-more-experience");
    if (showMoreBtn) {
        showMoreBtn.addEventListener("click", () => {
            const hiddenItems = document.querySelectorAll('[data-hidden="true"]');
            hiddenItems.forEach((item) => {
                item.removeAttribute("data-hidden");
                item.classList.remove("hidden");
            });
            showMoreBtn.style.display = "none";
        });
    }
</script>
